import e from "typescript";

import * as i from "node:path";

import { loadRef as a } from "@gql.tada/internal";

import { getGraphQLDiagnostics as r } from "@0no-co/graphqlsp/api";

import { e as o, p as t } from "./index-chunk.mjs";

var n = o((async function* _runDiagnostics(o) {
  var n = i.dirname(o.configPath);
  var l = t(o);
  var s = l.createExternalFiles();
  if (s.length) {
    yield {
      kind: "EXTERNAL_WARNING"
    };
    await l.addVirtualFiles(s);
  }
  var g = await a(o.pluginConfig).load({
    rootPath: n
  });
  var f = l.build();
  var c = f.buildPluginInfo(o.pluginConfig);
  var d = f.getSourceFiles();
  yield {
    kind: "FILE_COUNT",
    fileCount: d.length
  };
  for (var m of d) {
    var u = m.fileName.endsWith(".vue.ts") || m.fileName.endsWith(".svelte.ts");
    var v = m.fileName;
    c.config = {
      ...c.config,
      shouldCheckForColocatedFragments: u ? !1 : c.config.shouldCheckForColocatedFragments ?? !1,
      trackFieldUsage: u ? !1 : c.config.trackFieldUsage ?? !1
    };
    var h = r(v, g, c);
    var p = [];
    if (h && h.length) {
      for (var C of h) {
        if (!("messageText" in C) || "string" != typeof C.messageText || !C.file) {
          continue;
        }
        var y = "info";
        if (C.category === e.DiagnosticCategory.Error) {
          y = "error";
        } else if (C.category === e.DiagnosticCategory.Warning) {
          y = "warn";
        }
        var F = f.getSourcePosition(m, {
          start: C.start || 1,
          length: C.length || 1
        });
        v = F.fileName;
        p.push({
          severity: y,
          message: C.messageText,
          file: F.fileName,
          line: F.line,
          col: F.col,
          endLine: F.endLine,
          endColumn: F.endColumn
        });
      }
    }
    yield {
      kind: "FILE_DIAGNOSTICS",
      filePath: v,
      messages: p
    };
  }
}));

export { n as runDiagnostics };
//# sourceMappingURL=thread-chunk3.mjs.map
